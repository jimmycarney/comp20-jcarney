<!DOCTYPE html>
<html>
<head>
	<title>Historic Landmarks Map</title>
	<meta name="viewport" content="initial-scale=1.0" />
  	<link rel="stylesheet" href="style.css"/>
  	<meta charset="utf-8" />
	<script src="https://maps.google.com/maps/api/js?sensor=true"></script>
	<script type="text/javascript">
		var login = 'ymOsHX1N';
		var lng = 0;
		var lat = 0;
		var map;
		var centerLocation;
		var myMark;
		var info;

		/* gets current location using navigator.geolocation
		 * creates new instance of XMLHttpRequest
		 * sends current location and login data to Ming's server
		 * gets back all data in "request.responseText"
		 * calls initMap() now that the current location is stored
		 */
		function sendLocation() {
			if (navigator.geolocation){
				navigator.geolocation.getCurrentPosition(function(position) {
					lng = position.coords.longitude;
					lat = position.coords.latitude;
					/*send info using XMLHttpRequest*/
					var request = new XMLHttpRequest();
					request.open("POST", "https://defense-in-derpth.herokuapp.com/sendLocation", true);
					request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
					request.onreadystatechange = function() {
						alert(request.responseText);
					};
					var sendParams = "login=" + login + "&lat=" + lat + "&lng=" + lng;
					request.send(sendParams);
					initMap();
				});
			}
		}

		/* sets centerLocation to be coordinates of current location
		 * sets mapOptions to certain zoom and centerLocation
		 * creates a new map
		 * creates a marker for current location
		 * creates a new info window and calls initInfo
		 */
		function initMap() {
			centerLocation = new google.maps.LatLng(lat, lng);
			var mapOptions = {
				zoom: 14,
				center: centerLocation
			};
			map = new google.maps.Map(document.getElementById("map"), mapOptions);
			
			myMark = new google.maps.Marker({
				position: centerLocation,
				title: login, 
				latitude: lat,
				longitude: lng
			});
			myMark.setMap(map);

			info = new google.maps.InfoWindow();
			google.maps.event.addListener(myMark, 'click', initInfo);
		}
		function initInfo() {
			info.setContent(myMark.title);
			info.open(map, myMark);
		}
	</script>
</head>
<body onload="sendLocation()">
	<div id="map"></div>
</body>
</html>